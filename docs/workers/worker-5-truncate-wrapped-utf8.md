# Субагент 5: Обрезка и перенос текста (границы UTF-8)

**Задача:** Исключить разрез UTF-8 посередине кодовой точки при обрезке и переносе строк.

**Сделано:**
- В `Font.cpp` введены вспомогательные функции (анонимное пространство имён, с использованием `Utf8::NextCodePoint`): подсчёт кодовых точек, смещение после N кодовых точек, подстрока «первые N кодовых точек», «последние N кодовых точек».
- В `TruncateBack`, `TruncateFront`, `TruncateMiddle` вместо байтового `str.substr` используются эти подстроки по кодовым точкам, чтобы не резать многобайтовый символ.
- В `TruncateEndsOrMiddle` бинарный поиск переведён на количество кодовых точек (верхняя граница — число кодовых точек строки); `getResultString(str, nextChars)` получает nextChars в кодовых точках и строит строки по границам символов.
- В `WrappedText.cpp` изменений нет: разбиение только по пробельным символам (однобайтовым в UTF-8), резов внутри символа не происходит.

**Файлы:** source/text/Font.cpp.
