## Техническое задание: режим «Автопилот»

---

### 1. Цель и общая идея

- **Цель:** реализовать режим автоматической игры «Автопилот», в котором корабль игрока сам берёт и выполняет задания (в первую очередь доставки грузов/пассажиров), в зависимости от настроек либо избегая боёв, либо вступая в них, и не выполняет никаких других активностей вручную. Режим включается и выключается одной назначаемой клавишей управления («горячей клавишей автопилота»).
- **Ограничения:** в режиме авто-работы:
  - берутся только те группы миссий, которые включены в настройках вкладки «Автопилот» (см. §3.2 и §4.1);
  - поведение корабля в бою полностью определяется настройкой «Поведение в бою» (см. §3.2 и §4.3);
  - игрок не может взаимодействовать с игровым интерфейсом, кроме управления автопилотом через назначенную клавишу и работы системных диалогов.

---

### 2. Пользовательские сценарии

#### 2.1. Включение режима

1. Игрок находится в обычном режиме игры (ручное управление).
2. В настройках на вкладке «Автопилот» (см. §3.2) заранее назначена клавиша включения/выключения автопилота.
3. Игрок нажимает назначенную клавишу автопилота:
   - режим автопилота переходит в состояние «включено» (в HUD отображается явная индикация активного автопилота);
   - включается режим авто-работы;
   - остальной интерфейс блокируется (см. §3.3).

#### 2.2. Работа режима

После включения:

- Игра начинает искать и брать доступные миссии включённых групп (§4.1), подходящие для текущего корабля/флота (по вместимости, дальности, репутации и т.п.).
- При наличии подходящей миссии:
  - миссия автоматически принимается;
  - строится маршрут до цели (или последовательности целей);
  - корабль сам совершает взлёты/прыжки/посадки до завершения миссии.
- После завершения миссии игра:
  - получает награду;
  - может сразу искать следующую подходящую миссию включённых типов.
- Если подходящих миссий включённых типов нет:
  - игра организует полёт по человеческим системам с посадками на планеты/порты и проверкой новых миссий; если игрок не в человеческом пространстве — сначала перелёт к нему (см. §4.4).

#### 2.3. Выключение режима

1. Игрок повторно нажимает ту же назначенную клавишу автопилота.
2. Режим авто-работы выключается:
   - режим переходит в обычное (выключенное) состояние, индикация в HUD гаснет;
   - блокировка интерфейса снимается;
   - управление кораблём полностью возвращается игроку с текущего положения.

#### 2.4. Прерывание по событиям

Режим должен автоматически отключаться (с переводом управления пользователю), если:

- корабль/флот оказывается в боевой ситуации, где в рамках выбранного поведения автопилота требуется ручное вмешательство (см. §4.3);
- игрок явно вмешивается через клавишу управления автопилотом (повторное нажатие).

**Критические ситуации (низкое топливо или здоровье):** при критическом уровне топлива или повреждений корабля автопилот не отключается сразу, а переходит в режим спасения (см. §4.5): приоритет — убежать из опасной зоны и сесть на планету/станцию для починки и заправки. После успешной посадки, починки и заправки авто-режим продолжает работу (поиск и выполнение миссий). Автоматическое отключение с передачей управления игроку происходит только если безопасная посадка для починки/заправки невозможна (нет достижимой планеты/порта, недостаточно топлива для перелёта и т.п.) или при иной нештатной ситуации, не покрытой логикой авто-режима.

В случаях отключения:

- авто-режим завершается;
- интерфейс полностью разблокируется;
- игроку при необходимости показывается краткое сообщение о причине отключения (текст и реализация — отдельной задачей).

---

### 3. UI и UX-требования

#### 3.1. Индикация режима «Автопилот» в HUD

- **Расположение:** правый нижний угол основного игрового интерфейса (над/рядом с уже существующими элементами, не перекрывая критичные UI-области).
- **Подпись:** «Автопилот» (при необходимости — укороченная надпись + tooltip, но в ТЗ фиксируем именно это название).
- **Состояния:**
  - выключено (по умолчанию):
    - стандартный стиль индикатора;
    - tooltip: «Автопилот выключен. Нажмите назначенную клавишу автопилота, чтобы включить.»;
  - включено (активный авто-режим):
    - визуальное выделение (другая заливка/рамка/иконка);
    - tooltip: «Автопилот включён. Нажмите назначенную клавишу автопилота, чтобы выключить.».
- **Доступность:**
  - во время загрузок/диалогов/меню, где нет игрового процесса, индикатор может быть скрыт/неактивен согласно общим правилам UI (важно не ломать текущие экраны).

#### 3.2. Настройки автопилота (вкладка «Автопилот»)

- В меню настроек игры добавить отдельную вкладку **«Автопилот»**, которая будет пятой вкладкой после уже существующих вкладок «Управление», «Настройки», «Плагины» и «Звук», по аналогии с ними.
- На вкладке «Автопилот» разместить настройки:
  - **Клавиша вкл/выкл автопилота** — назначаемая клавиша (key binding), по тем же правилам, что и другие действия управления; по умолчанию не назначена (режим недоступен, пока игрок не назначит клавишу).
  - **Группы миссий** (булевые флаги, каждая опция независима):
    - «Брать миссии доставки» (cargo / passenger / delivery) — по умолчанию `true`;
    - «Брать миссии сопровождения» — по умолчанию `false`;
    - «Брать миссии патрулирования» — по умолчанию `false`;
    - «Брать миссии охоты» — по умолчанию `false`;
    - «Брать исследовательские миссии» — по умолчанию `false`;
    - «Брать сюжетные/особые миссии» — по умолчанию `false`.
  - **Поведение в бою** — переключатель с вариантами «Убегать» / «Сражаться»; по умолчанию «Убегать».
  - **Время ожидания на планете (сек)** — число секунд, которое корабль ждёт на планете/порту после посадки перед тем, как продолжить выполнение (поиск миссий, построение маршрута, взлёт); по умолчанию 5.
- Изменения настроек применяются к новому циклу работы автопилота (поведение уже активного режима может обновляться сразу или на следующем шаге логики — на усмотрение реализации).

#### 3.3. Блокировка интерфейса

- При включённом авто-режиме:
  - **все элементы управления, кроме системных диалогов и клавиши автопилота, становятся недоступными**:
    - мышью нельзя нажать на другие кнопки UI;
    - горячие клавиши, управляющие полётом, стрельбой, посадкой, миссиями и т.п., игнорируются (единственный пользовательский контроль — клавиша включения/выключения автопилота);
  - визуально можно (опционально) подсветить, что UI «заблокирован», но это не обязательная часть этого ТЗ.
- Блокировка не должна мешать:
  - системным диалогам выхода/крита;
  - обработке событий сохранения/автосохранения;
  - базовым internal-процессам (симуляции вселенной).

---

### 4. Игровая логика авто-режима

#### 4.1. Типы миссий

- В авто-режиме **список типов миссий, которые может брать автопилот, определяется настройками вкладки «Автопилот»** (§3.2):
  - миссии доставки (стандартные «cargo»/«passenger» и иные чисто логистические миссии без обязательного боя);
  - миссии сопровождения (escort);
  - патрульные миссии;
  - миссии охоты;
  - исследовательские миссии;
  - сюжетные/особые миссии.
- По умолчанию включены только миссии доставки; остальные группы выключены.
- Если группа миссий отключена в настройках, автопилот такие миссии не рассматривает как кандидатов и не принимает автоматически, даже если они доступны на планете.

Критерии отбора миссий по группам должны быть сформулированы в коде через уже существующие флаги/типы миссий (без ручного списка имён).

#### 4.2. Алгоритм выбора миссии (упрощённый)

Последовательность при включении/завершении миссии:

1. Проверить активные миссии:
   - если уже есть незавершённые миссии включённых типов, попытаться продолжить/доделать их;
   - если все выполнены или их нет, перейти к поиску новых.
2. Поиск новых миссий:
   - просмотреть доступные миссии в текущей системе/на планете;
   - отфильтровать только допустимые миссии включённых групп (см. §4.1);
   - отфильтровать по техническим ограничениям:
     - достаточно ли места в трюме/каютах;
     - достижима ли цель по дальности/топливу/сколько прыжков;
     - нет ли конфликтов с уже взятыми миссиями.
   - **перед взлётом обязательно выполнить попытку взять миссию**, если на текущей планете/порту есть подходящие варианты.
3. Выбрать одну или несколько миссий по простой стратегии:
   - по умолчанию брать **не более одной миссии за раз**;
   - допускается взять несколько миссий только если у них **совпадает точка назначения** (одна и та же целевая планета/порт; при отсутствии точной планеты — одна и та же целевая система);
   - миссии с разными точками назначения в один пакет не объединять.
4. Построить маршрут и запустить автоматическое выполнение (см. §4.4).
5. Если подходящей миссии нет:
   - взлёт разрешён без взятой миссии;
   - продолжить перелёт по логике поиска новых миссий (§4.4).

Конкретная политика выбора (жадная, по прибыли, по кратчайшему маршруту) может быть упрощённой, главное — корректность и предсказуемость.

#### 4.3. Поведение в бою (сражаться / убегать)

Поведение автопилота в боевых ситуациях определяется настройкой «Поведение в бою» (§3.2):

- При значении **«Убегать»**:
  - корабль не инициирует стрельбу (не стреляет первым, не использует оружие по собственной инициативе);
  - при атаке приоритет — уйти из боя (прыжок/посадка, если безопасно и возможно);
  - допускается пассивное поведение без сложной боевой тактики;
  - автопилот не принимает миссии, в логике которых явно предусмотрены обязательные бои.

- При значении **«Сражаться»**:
  - корабль может использовать существующую логику боевого AI для защиты и выполнения боевых частей взятых миссий;
  - автопилот не добавляет нового сложного тактического слоя сверх уже существующего AI в рамках этого ТЗ.

Если движок не позволяет надёжно отличить «безопасные» и «боевые» маршруты, автопилот в режиме «Убегать» решает только задачи движения и выбора миссий, а боевая модель остаётся минимально инертной.

#### 4.4. Автоматическое перемещение и время

При активном авто-режиме:

- Игра управляет:
  - взлётом/посадкой;
  - прыжками между системами;
  - стыковкой с нужными планетами/станциями;
  - временем ожидания (если требуется дождаться загрузки/срока и т.п.).
- **При отсутствии доступных миссий включённых типов** реализуется полёт с поиском новых заказов:
  - если игрок уже в **человеческом пространстве** (системы, принадлежащие человеческим правительствам): корабль совершает полёт по человеческим системам — перелёт из системы в систему, посадки на планеты/порты, при каждой посадке проверка списка новых миссий; при появлении подходящей миссии включённого типа — принять и выполнять;
  - если игрок **вне человеческого пространства**: сначала строится маршрут до ближайших человеческих систем, корабль летит к ним (с посадками по пути, где возможно); по прибытии в человеческое пространство — поведение как выше (полёт по человеческим системам с поиском миссий);
  - при построении маршрута **исключать из маршрута планеты, на которых уже были**; не повторять посещение одной и той же планеты в течение **10 перелётов** (чтобы не зацикливаться на одних и тех же портах).
- **После посадки** (на планету/порт): открывать экран планеты и ожидать **время, заданное в настройках** (§3.2 — «Время ожидания на планете (сек)», по умолчанию 5 с) перед дальнейшей работой (поиск миссий, построение маршрута и т.д.), чтобы игрок мог видеть контекст и чтобы логика миссий/интерфейса успевала обработать посадку.
- **Перед каждым взлётом с планеты/порта**: сначала выполнить проверку и попытку автопринятия миссии по правилам §4.2; если миссия не найдена или не подходит, взлёт всё равно допускается.
- **Одна посадка — все действия за один раз:** при посадке на планету/порт все необходимые действия (проверка миссий, приём заказов, починка/заправка при режиме спасения и т.д.) выполняются за один визит. **Взлёт и повторная посадка на ту же планету без критической причины не допускаются.** Критической причиной считаются только: малое топливо или здоровье (режим спасения §4.5), убегание из боя или опасной ситуации.
- Критерий «человеческие системы» задаётся по данным движка (например, правительство системы/планеты или атрибуты региона); при отсутствии явной разметки допускается использовать известный список имён систем/регионов из контента человеческой части карты.

#### 4.5. Критические ситуации: низкое топливо или здоровье

При достижении критического уровня топлива или повреждений (здоровья) корабля автопилот переходит в режим спасения:

- **Приоритет:** убежать из текущей опасной ситуации (выйти из боя, покинуть систему при необходимости) и совершить посадку на ближайшую достижимую планету или порт, где возможны починка и заправка.
- **Поведение:** маршрут перепланируется на цель «посадка для ремонта/заправки»; текущая миссия при необходимости откладывается. Корабль не берёт новые миссии до завершения починки и заправки.
- **После посадки:** на планете/порту выполняются починка и заправка (средствами движка); по завершении автопилот возобновляет обычный цикл работы — поиск и выполнение миссий включённых типов (§4.1, §4.2).
- **Отключение режима:** если безопасная посадка для починки/заправки недостижима (нет подходящей планеты в радиусе, недостаточно топлива для прыжка и т.п.), авто-режим отключается и управление передаётся игроку (§2.4).

Таким образом, в критических ситуациях автопилот сначала пытается сохранить корабль и восстановить его состояние, и только после этого продолжает работу или отключается при невозможности спасения.

---

### 5. Состояния и переключение (логика состояния)

Режим можно описать простой конечной автоматной моделью:

- **Idle (ручной режим)**:
  - авто-режим выключен;
  - интерфейс полностью доступен;
  - при нажатии на клавишу автопилота → переход в `AutoActive`.

- **AutoActive (авто-режим включён)**:
  - интерфейс заблокирован, кроме системных диалогов и клавиши автопилота;
  - выполняется цикл:
    0. если критическое топливо или здоровье → режим спасения: убегать и садиться на планету/порт для починки и заправки (§4.5); после починки/заправки — вернуться к п. 1–3;
    1. если есть активные миссии включённых типов → вести к их целям;
    2. если таких миссий нет → искать и брать новые миссии (на текущей планете/в системе) в рамках разрешённых групп (§4.1);
    3. если миссий нет → полёт по человеческим системам (или сначала перелёт к ним) с посадками и поиском новых миссий на каждой планете/порту.
  - события для выхода:
    - повторное нажатие на клавишу автопилота → `Idle`;
    - критическое событие/бой (в т.ч. невозможность безопасной посадки для спасения) → `Interrupted`.

- **Interrupted (авто-режим прерван)**:
  - авто-режим завершён;
  - интерфейс разблокирован;
  - игрок управляет ситуацией вручную.

Переходы должны быть чётко реализованы без зацикливаний и «залипаний» в промежуточных состояниях.

---

### 6. Требования к интеграции и сохранениям

- Состояние авто-режима (включён/выключен) должно корректно:
  - сбрасываться при загрузке сохранения или перезапуске игры (по умолчанию: выключен);
  - корректно завершаться при любых штатных выходах из игры/полёта.
- Не допускается ситуация, при которой:
  - игрок загружает сохранение и оказывается в скрытно активном авто-режиме;
  - UI остаётся частично заблокированным после аварийного отключения режима.

---

### 7. Нефункциональные требования

- **Минимальное вмешательство в существующую логику:** реализация должна по возможности использовать уже существующие функции:
  - выбора/принятия миссий;
  - построения маршрута;
  - автоматического полёта/переходов;
  - UI-блокировок/фокуса ввода (если такие механизмы уже есть).
- **Безопасность:** авто-режим не должен ломать:
  - сюжетные скрипты;
  - сохранения;
  - уже существующее управление игроком.
- **Расширяемость:** логика выбора миссий и маршрутов должна быть реализована так, чтобы её можно было позднее улучшать (более умный выбор по прибыли, учёт риска боёв и т.п.) без изменения индикатора, вкладки настроек и общих контрактов режима.

---

### 8. Опора на существующий код

Реализация должна максимально опираться на уже имеющиеся механизмы движка.

#### 8.1. Посадка и прыжок в гиперпространство

- **Command::LAND** (`source/Command.cpp`: «Land on planet / station»): пока у корабля установлена цель на посадочный объект (`Ship::GetTargetStellar()`) и выдана команда `Command::LAND`, в `Ship::Advance` выполняется посадка (проверка `CanLand()`, затем логика приземления). Авто-режим должен выставлять цель на планету/станцию и добавлять `Command::LAND` в активные команды флагмана (или в автопилот).
- **Command::JUMP** (`source/Command.cpp`: «Initiate hyperspace jump»): при цели на систему (`Ship::GetTargetSystem()`) и команде `Command::JUMP` корабль входит в гиперпространство и переходит в целевую систему (`Ship::DoHyperspaceLogic`, `hyperspaceSystem`, переход по завершении анимации). Авто-режим должен задавать целевую систему (`Ship::SetTargetSystem`) и выдавать `Command::JUMP` (при необходимости `Command::FLEET_JUMP` для флота).
- Выдача команд: в `Engine` команды игрока собираются в `activeCommands` и передаются в AI; для флагмана те же биты (`Command::LAND`, `Command::JUMP`) используются для полёта. Логика авто-режима может формировать «виртуальный» набор команд (посадка/прыжок к текущей цели маршрута) и подмешивать его в то, что получает флагман, либо выставлять `PlayerInfo::TravelPlan()` и полагаться на существующую логику автопилота по маршруту.

#### 8.2. Маршрут и автопилот

- **PlayerInfo::TravelPlan()** (`source/PlayerInfo.h/cpp`): список систем маршрута. Уже используется при полёте по карте: игрок строит маршрут, корабль летит по нему. В `AI.cpp` при наличии `player.HasTravelPlan()` флагману выставляется `SetTargetSystem(player.TravelPlan().back())`, выдаются `Command::JUMP` / `Command::LAND`. Авто-режим может строить маршрут до цели доставки (система/планета) и записывать его в `TravelPlan()`, после чего опираться на существующую логику следования по маршруту и посадки.
- **Ship::SetTargetStellar()** / **Ship::SetTargetSystem()**: установка цели для посадки или прыжка; уже используются AI и при клике по карте/планете.

#### 8.3. Посадка на планету и миссии

- **Mission::Land(const Planet *, PlayerInfo &, UI &)** (`source/Mission.cpp`): вызывается при посадке на планету; обрабатывает действия миссий «on land». Игра уже вызывает это при посадке игрока; авто-режим не должен дублировать логику миссий — достаточно обеспечивать целевые посадки (через LAND + цель на планету), после чего стандартная обработка посадки и миссий выполнится сама.
- Принятие миссий: используется существующий API доступа к списку доступных миссий/заказов и принятия их игроком (например, через `PlayerInfo` и объекты миссий); критерии отбора по включённым группам миссий (§4.1) реализуются в коде авто-режима поверх этого API.

#### 8.4. Интерфейс, индикация и настройки автопилота

- Интерфейс **"hud"** (`data/_ui/interfaces.txt`) рисуется в `Engine`. Для режима «Автопилот» нужно в коде: добавить в интерфейс «hud» (или отрисовывать в `Engine`) **некликабельный индикатор** состояния автопилота (см. §3.1), не регистрирующий зону клика; текст индикатора и tooltip брать из данных/перевода (ключи перевода). Включение/выключение режима обрабатывается по нажатию назначенной клавиши (key binding из §3.2), а не по клику по HUD. При добавлении или изменении кнопок/вкладок интерфейса необходимо обновлять как основной файл `data/_ui/interfaces.txt` игры, так и данные локализационного плагина `ru-data-translation` в `%AppData%\Roaming\endless-sky\plugins\ru-data-translation\data`.
- Вкладка настроек «Автопилот» (§3.2) реализуется поверх существующей системы вкладок настроек и биндингов клавиш: новая вкладка добавляется рядом с «Управление» и «Настройки»; параметры (клавиша автопилота, флаги групп миссий, поведение в бою) хранятся и сохраняются теми же механизмами, что и остальные пользовательские настройки (не в сохранении игры).

---

### 10. Стратегия реализации с субагентами

При выполнении задач по данному ТЗ необходимо использовать субагентов (параллельные агентные потоки) для ускорения работы и экономии токенов. Ниже описано, как правильно разделить работу, чтобы субагенты не конфликтовали по файлам и зависимостям.

#### 10.1. Принципы безопасного разделения работ

- **Одна задача — один файл-владелец.** Каждый субагент получает строго ограниченный список файлов, в которые он пишет. Ни один файл не редактируется двумя субагентами одновременно.
- **Интерфейс (`.h`) сначала, реализация потом.** Все субагенты, зависящие от нового класса, ждут финализации его заголовочного файла (`.h`) перед стартом; тело реализации (`.cpp`) может писаться параллельно с потребителями.
- **Фазовое выполнение.** Работа делится на последовательные фазы; внутри каждой фазы субагенты запускаются параллельно. Следующая фаза стартует только после завершения всех субагентов текущей.
- **Контракт на стыке.** Если субагент B зависит от вывода субагента A (например, от имени метода), A обязан задекларировать публичный интерфейс до старта B. Конкретные сигнатуры фиксируются в этом документе или в отдельном файле-контракте перед запуском фазы.

#### 10.2. Карта файлов по задачам

| Задача | Файлы (только эти) | Зависит от |
|---|---|---|
| **A. AutopilotManager — заголовок** | `source/AutopilotManager.h` (новый) | — |
| **B. AutopilotManager — реализация** | `source/AutopilotManager.cpp` (новый) | A (заголовок) |
| **C. Вкладка настроек «Автопилот»** | `source/PreferencesPanel.cpp`, `source/PreferencesPanel.h` | A (чтение состояния настроек) |
| **D. HUD-индикатор** | `source/Engine.cpp` *(только секция рендеринга HUD)*, `data/_ui/interfaces.txt`, `%AppData%/.../ru-data-translation/data/...` | A (чтение флага активности) |
| **E. Обработка ввода и блокировка UI** | `source/MainPanel.cpp` | A (переключение состояния), C (чтение привязки клавиши) |
| **F. Интеграция с AI и движком (команды LAND/JUMP)** | `source/AI.cpp`, `source/PlayerInfo.cpp` *(только секция TravelPlan)* | B (полная реализация AutopilotManager) |

> `source/Engine.cpp` разделён между задачами D и F, поэтому **D и F не запускаются в одной фазе**. D редактирует только секцию рендеринга HUD; F — только секцию обработки команд флагмана.

#### 10.3. Фазы параллельного выполнения

```
Фаза 0  (последовательно, 1 субагент)
└─ A: AutopilotManager.h — определить все публичные методы, enum State,
      структуру настроек. Зафиксировать сигнатуры в документе.

Фаза 1  (параллельно, до 4 субагентов одновременно)
├─ B: AutopilotManager.cpp  ← файлы: только AutopilotManager.cpp
├─ C: PreferencesPanel       ← файлы: PreferencesPanel.h/.cpp
├─ D: HUD-индикатор          ← файлы: Engine.cpp (HUD-секция), interfaces.txt, перевод
└─ E: MainPanel (ввод/блок.) ← файлы: MainPanel.cpp

Фаза 2  (последовательно, 1 субагент — после завершения всей Фазы 1)
└─ F: AI + PlayerInfo интеграция ← файлы: AI.cpp, PlayerInfo.cpp (TravelPlan)
```

#### 10.4. Контракт интерфейса (заполняется в Фазе 0)

Перед стартом Фазы 1 субагент A должен зафиксировать в `AutopilotManager.h` и продублировать здесь следующие контрактные точки:

- `enum class AutopilotState { Idle, AutoActive, Interrupted }` — состояния машины;
- `AutopilotState GetState() const` — читается субагентами D и E;
- `void Toggle()` — вызывается субагентом E по нажатию клавиши;
- `void Tick(PlayerInfo &, UI &)` — вызывается субагентом F один раз за игровой такт;
- `const AutopilotSettings & GetSettings() const` — читается субагентами C и D;
- `void ApplySettings(const AutopilotSettings &)` — вызывается субагентом C при сохранении настроек;
- `struct AutopilotSettings` — поля: `bool takeCargo`, `bool takeEscort`, `bool takePatrol`, `bool takeHunting`, `bool takeExploration`, `bool takeStory`; `enum CombatBehavior { Flee, Fight }`; `int planetWaitSeconds`.

Если при реализации требуются дополнительные методы — они добавляются в `.h` и документируются здесь до того, как субагент-потребитель начинает писать код.

#### 10.5. Правила для каждого субагента

1. **Перед стартом** — прочитать этот раздел и убедиться, что предыдущая фаза завершена (зафиксированы сигнатуры в §10.4).
2. **Работать только со своими файлами** из таблицы §10.2; при обнаружении, что нужный код находится в чужом файле — не редактировать его, а сообщить об этом и дождаться согласования.
3. **Не рефакторить чужой код** — только добавлять/изменять то, что прямо требует задача.
4. **После завершения** — кратко описать, что изменено и какие публичные точки были добавлены или использованы, чтобы следующая фаза могла на них опереться.
5. **Локализация** — если субагент добавляет текстовые строки в основной код, он также обновляет файл перевода в `ru-data-translation` (не оставлять это другому субагенту).

---

### 9. Критерии приёмки

- В настройках игры есть вкладка «Автопилот» с параметрами: клавиша вкл/выкл, булевые флаги групп миссий (доставка, сопровождение, патрулирование, охота, исследовательские, сюжетные/особые), переключатель «Поведение в бою» (Убегать / Сражаться), время ожидания на планете (сек).
- В HUD в правом нижнем углу отображается индикатор «Автопилот» (включён/выключен); управление режимом — только назначенной клавишей.
- При нажатии назначенной клавиши автопилота:
  - режим включается, остальной UI блокируется (кроме системных диалогов и той же клавиши);
  - игра автоматически берёт и выполняет только миссии включённых групп (§4.1);
  - поведение в бою соответствует выбранной настройке «Поведение в бою» (§4.3).
- При повторном нажатии той же клавиши: авто-режим выключается, интерфейс разблокируется, управление возвращено игроку.
- При попадании в боевую/критическую ситуацию: авто-режим корректно прерывается, игрок получает управление и доступ к интерфейсу.
- После перезапуска игры/загрузки сохранения: авто-режим выключен по умолчанию; UI в стандартном состоянии, без скрытой блокировки; настройки вкладки «Автопилот» сохраняются и восстанавливаются.

